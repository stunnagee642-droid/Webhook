<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Webhook - Static Deployment</title>
<style>
    body { font-family: Arial; background:#121212; color:#fff; display:flex; flex-direction:column; align-items:center; padding:20px; }
    h1 { margin-top:20px; }
    button { padding:12px 24px; font-size:16px; cursor:pointer; background:linear-gradient(45deg,#ff00ff,#ff9900); border:none; border-radius:10px; color:#fff; margin-top:20px; transition:0.2s; }
    button:hover { transform:scale(1.05); }
    pre { background:#222; padding:20px; border-radius:10px; width:100%; max-width:600px; overflow-x:auto; margin-top:20px; }
    #deployBar { display:none; margin-top:20px; width:100%; max-width:600px; padding:15px; border-radius:12px; background:linear-gradient(90deg,#ff00ff,#ff9900); text-align:center; font-weight:bold; color:#fff; box-shadow:0 0 10px #ff00ff50; }
    #deployBar a { color:#fff; text-decoration:none; }
    #deployBar a:hover { text-decoration:underline; }
    #previewFrame { width:100%; height:500px; border:1px solid #444; margin-top:20px; border-radius:10px; }
</style>
</head>
<body>

<h1>Webhook - Static Deployment</h1>
<p>Click "Deploy" to deploy your site and see the live URL and preview.</p>
<button id="deployBtn">Deploy</button>

<pre id="console">üì° Waiting for deployment...</pre>

<!-- Deployment URL Bar -->
<div id="deployBar">
    <a id="deployLink" href="#" target="_blank"></a>
</div>

<h3>Preview:</h3>
<iframe id="previewFrame" src=""></iframe>

<script>
const consoleEl = document.getElementById('console');
const button = document.getElementById('deployBtn');
const deployBar = document.getElementById('deployBar');
const deployLink = document.getElementById('deployLink');
const previewFrame = document.getElementById('previewFrame');

button.addEventListener('click', async () => {
    consoleEl.textContent = "üì° Sending request to server...\n";
    deployBar.style.display = "none";
    previewFrame.src = "";

    try {
        const response = await fetch('/deploy', { method: 'POST' });
        if (!response.ok) throw new Error(`Server error: ${response.status}`);

        const data = await response.json();

        if (data.success) {
            consoleEl.textContent += "‚úÖ Deployment successful!\n";

            // Show live URL inside the URL bar
            deployLink.href = data.url;
            deployLink.textContent = data.url;
            deployBar.style.display = 'block';

            // Show deployed site in iframe
            previewFrame.src = data.url;
        } else {
            consoleEl.textContent += "‚ùå Deployment failed";
        }
    } catch(err) {
        consoleEl.textContent += `üî• Error: ${err.message}`;
    }
});
</script>

</body>
</html>
